<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>é…è‰²æ–¹æ¡ˆç”Ÿæˆå™¨</title>
    <style>
      body {
        font-family: "Roboto", "Arial", sans-serif;
        margin: 0;
        padding: 20px;
        background: #f8f9fa;
        color: #333;
      }

      .container {
        max-width: 320px;
        margin: 0 auto;
      }

      .header {
        text-align: center;
        margin-bottom: 25px;
      }

      .header h1 {
        font-size: 18px;
        font-weight: 500;
        margin: 0;
        color: #1976d2;
      }

      .input-group {
        margin-bottom: 20px;
      }

      .input-group label {
        display: block;
        margin-bottom: 6px;
        font-weight: 500;
        font-size: 14px;
        color: #666;
      }

      .input-field {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 14px;
        box-sizing: border-box;
        transition: border-color 0.3s;
      }

      .input-field:focus {
        outline: none;
        border-color: #1976d2;
        box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.1);
      }

      .color-preview {
        width: 40px;
        height: 40px;
        border: 2px solid #ddd;
        border-radius: 6px;
        margin-left: 10px;
        display: inline-block;
        vertical-align: middle;
        background: #fff;
        transition: all 0.3s;
      }

      .hex-input-container {
        display: flex;
        align-items: center;
      }

      .hex-input-container .input-field {
        flex: 1;
      }

      .generate-btn {
        width: 100%;
        padding: 12px;
        background: linear-gradient(135deg, #1976d2, #1565c0);
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s;
        margin-bottom: 20px;
      }

      .generate-btn:hover {
        background: linear-gradient(135deg, #1565c0, #0d47a1);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(25, 118, 210, 0.3);
      }

      .generate-btn:active {
        transform: translateY(0);
      }

      .generate-btn:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .color-palette {
        background: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
        min-height: 100px;
        display: none;
      }

      .color-palette.show {
        display: block;
      }

      .color-item {
        display: flex;
        align-items: center;
        margin-bottom: 12px;
        padding: 8px;
        border-radius: 6px;
        transition: background-color 0.3s;
      }

      .color-item:hover {
        background: #f5f5f5;
      }

      .color-swatch {
        width: 40px;
        height: 40px;
        border-radius: 6px;
        margin-right: 12px;
        border: 2px solid #eee;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        cursor: pointer;
        transition: transform 0.2s;
      }

      .color-swatch:hover {
        transform: scale(1.05);
      }

      .color-info {
        flex: 1;
      }

      .color-hex {
        font-size: 14px;
        font-weight: 500;
        color: #333;
        margin-bottom: 2px;
        font-family: "Courier New", monospace;
      }

      .color-name {
        font-size: 12px;
        color: #666;
      }

      .color-actions {
        display: flex;
        gap: 5px;
      }

      .action-btn {
        padding: 6px 10px;
        border: 1px solid #ddd;
        background: white;
        border-radius: 4px;
        font-size: 11px;
        cursor: pointer;
        transition: all 0.2s;
      }

      .action-btn:hover {
        background: #f0f0f0;
        border-color: #ccc;
      }

      .action-btn.copy {
        color: #1976d2;
      }

      .action-btn.apply {
        color: #4caf50;
      }

      .apply-buttons {
        display: flex;
        gap: 10px;
        margin-top: 20px;
      }

      .apply-btn {
        flex: 1;
        padding: 10px;
        border: 1px solid #ddd;
        background: white;
        border-radius: 6px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s;
      }

      .apply-btn.selected {
        background: #4caf50;
        color: white;
        border-color: #4caf50;
      }

      .apply-btn.create-page {
        background: #ff9800;
        color: white;
        border-color: #ff9800;
      }

      .apply-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      }

      .message {
        padding: 12px;
        border-radius: 6px;
        margin: 15px 0;
        font-size: 14px;
        display: none;
      }

      .message.success {
        background: #e8f5e8;
        color: #2e7d32;
        border: 1px solid #c8e6c9;
      }

      .message.error {
        background: #ffebee;
        color: #c62828;
        border: 1px solid #ffcdd2;
      }

      .loading {
        display: none;
        text-align: center;
        padding: 20px;
        color: #666;
      }

      .loading.show {
        display: block;
      }

      .spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 2px solid #f3f3f3;
        border-top: 2px solid #1976d2;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-right: 8px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .scheme-info {
        font-size: 12px;
        color: #666;
        margin-top: 5px;
        line-height: 1.4;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ğŸ¨ é…è‰²æ–¹æ¡ˆç”Ÿæˆå™¨</h1>
      </div>

      <div class="input-group">
        <label for="hexInput">ä¸»è‰² HEX å€¼</label>
        <div class="hex-input-container">
          <input
            type="text"
            id="hexInput"
            class="input-field"
            placeholder="ä¾‹å¦‚: #3D6869 æˆ– 3D6869"
            value="#3D6869"
          />
          <div class="color-preview" id="colorPreview"></div>
        </div>
      </div>

      <div class="input-group">
        <label for="schemeSelect">é…è‰²é¢¨æ ¼</label>
        <select id="schemeSelect" class="input-field">
          <option value="monochromatic">å–®è‰²ç³» (Monochromatic)</option>
          <option value="analogous">é¡ä¼¼è‰² (Analogous)</option>
          <option value="complementary">äº’è£œè‰² (Complementary)</option>
          <option value="split-complementary">
            åˆ†è£‚äº’è£œè‰² (Split Complementary)
          </option>
          <option value="triadic">ä¸‰åˆ†è‰² (Triadic)</option>
          <option value="tetradic">å››æ–¹è‰² (Tetradic)</option>
          <option value="golden-ratio">é»ƒé‡‘æ¯”ä¾‹ (Golden Ratio)</option>
        </select>
        <div class="scheme-info" id="schemeInfo">
          åŸºæ–¼ä¸åŒçš„äº®åº¦å’Œé£½å’Œåº¦è®ŠåŒ–ç”¢ç”Ÿå”èª¿çš„å–®è‰²ç³»é…è‰²
        </div>
      </div>

      <button class="generate-btn" id="generateBtn" onclick="generatePalette()">
        ç”Ÿæˆé…è‰²æ–¹æ¡ˆ
      </button>

      <div class="message" id="messageArea"></div>

      <div class="loading" id="loadingArea">
        <div class="spinner"></div>
        æ­£åœ¨ç”Ÿæˆé…è‰²æ–¹æ¡ˆ...
      </div>

      <div class="color-palette" id="colorPalette">
        <div id="paletteColors"></div>
        <div class="apply-buttons">
          <button
            class="apply-btn selected"
            id="applySelectedBtn"
            onclick="applyToSelected()"
          >
            å¥—ç”¨åˆ°é¸ä¸­ç‰©ä»¶
          </button>
          <button
            class="apply-btn create-page"
            id="createPageBtn"
            onclick="createColorPage()"
          >
            å»ºç«‹è‰²å¡é é¢
          </button>
        </div>
      </div>
    </div>

    <script>
      let currentColors = [];
      let currentScheme = "";

      // é…è‰²æ–¹æ¡ˆèªªæ˜
      const schemeDescriptions = {
        monochromatic: "åŸºæ–¼ä¸åŒçš„äº®åº¦å’Œé£½å’Œåº¦è®ŠåŒ–ç”¢ç”Ÿå”èª¿çš„å–®è‰²ç³»é…è‰²",
        analogous: "ä½¿ç”¨è‰²ç›¸ç’°ä¸Šç›¸é„°çš„é¡è‰²ï¼Œç”¢ç”Ÿå’Œè«§è‡ªç„¶çš„é…è‰²æ•ˆæœ",
        complementary: "ä½¿ç”¨è‰²ç›¸ç’°å°é¢çš„é¡è‰²ï¼Œç”¢ç”Ÿå¼·çƒˆå°æ¯”å’Œè¦–è¦ºè¡æ“Š",
        "split-complementary": "ä½¿ç”¨äº’è£œè‰²å…©å´çš„é¡è‰²ï¼Œæ—¢æœ‰å°æ¯”åˆä¿æŒå’Œè«§",
        triadic: "ä½¿ç”¨è‰²ç›¸ç’°ä¸Šç­‰è·çš„ä¸‰å€‹é¡è‰²ï¼Œç”¢ç”Ÿé®®æ˜ä¸”å¹³è¡¡çš„æ•ˆæœ",
        tetradic: "ä½¿ç”¨å…©å°äº’è£œè‰²ï¼Œæä¾›è±å¯Œçš„é…è‰²é¸æ“‡å’Œå¹³è¡¡æ„Ÿ",
        "golden-ratio": "åŸºæ–¼é»ƒé‡‘æ¯”ä¾‹è§’åº¦è¨ˆç®—ï¼Œç”¢ç”Ÿè‡ªç„¶å„ªç¾çš„é…è‰²çµ„åˆ",
      };

      // åˆå§‹åŒ–
      document.addEventListener("DOMContentLoaded", function () {
        updateColorPreview();
        updateSchemeInfo();
      });

      // æ›´æ–°é¡è‰²é è¦½
      function updateColorPreview() {
        const hex = document.getElementById("hexInput").value.trim();
        const preview = document.getElementById("colorPreview");

        if (isValidHex(hex)) {
          const normalizedHex = normalizeHex(hex);
          preview.style.backgroundColor = normalizedHex;
          preview.style.borderColor = "#4caf50";
        } else {
          preview.style.backgroundColor = "#fff";
          preview.style.borderColor = "#ddd";
        }
      }

      // æ›´æ–°é…è‰²æ–¹æ¡ˆèªªæ˜
      function updateSchemeInfo() {
        const scheme = document.getElementById("schemeSelect").value;
        const info = document.getElementById("schemeInfo");
        info.textContent = schemeDescriptions[scheme] || "";
      }

      // é©—è­‰ HEX æ ¼å¼
      function isValidHex(hex) {
        const hexRegex = /^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/;
        return hexRegex.test(hex);
      }

      // æ¨™æº–åŒ– HEX æ ¼å¼
      function normalizeHex(hex) {
        hex = hex.replace("#", "");
        if (hex.length === 3) {
          hex = hex
            .split("")
            .map((char) => char + char)
            .join("");
        }
        return "#" + hex.toUpperCase();
      }

      // é¡¯ç¤ºè¨Šæ¯
      function showMessage(message, type = "success") {
        const messageArea = document.getElementById("messageArea");
        messageArea.textContent = message;
        messageArea.className = `message ${type}`;
        messageArea.style.display = "block";

        setTimeout(() => {
          messageArea.style.display = "none";
        }, 3000);
      }

      // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
      function showLoading(show) {
        const loading = document.getElementById("loadingArea");
        const btn = document.getElementById("generateBtn");

        if (show) {
          loading.classList.add("show");
          btn.disabled = true;
        } else {
          loading.classList.remove("show");
          btn.disabled = false;
        }
      }

      // ç”Ÿæˆé…è‰²æ–¹æ¡ˆ
      function generatePalette() {
        const hex = document.getElementById("hexInput").value.trim();
        const scheme = document.getElementById("schemeSelect").value;

        // é©—è­‰è¼¸å…¥
        if (!hex) {
          showMessage("è«‹è¼¸å…¥ä¸»è‰² HEX å€¼", "error");
          return;
        }

        if (!isValidHex(hex)) {
          showMessage(
            "è«‹è¼¸å…¥æœ‰æ•ˆçš„ HEX é¡è‰²æ ¼å¼ï¼ˆä¾‹å¦‚ï¼š#FF0000 æˆ– FF0000ï¼‰",
            "error",
          );
          return;
        }

        showLoading(true);

        // å‘¼å« Apps Script å‡½æ•¸
        google.script.run
          .withSuccessHandler(onGenerateSuccess)
          .withFailureHandler(onGenerateFailure)
          .generateColorScheme(hex, scheme);
      }

      // ç”ŸæˆæˆåŠŸå›èª¿
      function onGenerateSuccess(result) {
        showLoading(false);

        if (result.success) {
          currentColors = result.colors;
          currentScheme =
            document.getElementById("schemeSelect").selectedOptions[0].text;
          displayColorPalette(result.colors);
          showMessage(result.message, "success");
        } else {
          showMessage(result.message, "error");
        }
      }

      // ç”Ÿæˆå¤±æ•—å›èª¿
      function onGenerateFailure(error) {
        showLoading(false);
        showMessage("ç”Ÿæˆé…è‰²æ–¹æ¡ˆæ™‚ç™¼ç”ŸéŒ¯èª¤: " + error.message, "error");
      }

      // é¡¯ç¤ºé…è‰²æ–¹æ¡ˆ
      function displayColorPalette(colors) {
        const palette = document.getElementById("colorPalette");
        const paletteColors = document.getElementById("paletteColors");

        paletteColors.innerHTML = "";

        colors.forEach((color, index) => {
          const colorItem = document.createElement("div");
          colorItem.className = "color-item";

          colorItem.innerHTML = `
                    <div class="color-swatch" style="background-color: ${color}" 
                         onclick="copyColorToClipboard('${color}')"></div>
                    <div class="color-info">
                        <div class="color-hex">${color}</div>
                        <div class="color-name">é¡è‰² ${index + 1}</div>
                    </div>
                    <div class="color-actions">
                        <button class="action-btn copy" onclick="copyColorToClipboard('${color}')">
                            è¤‡è£½
                        </button>
                        <button class="action-btn apply" onclick="applySingleColor('${color}')">
                            å¥—ç”¨
                        </button>
                    </div>
                `;

          paletteColors.appendChild(colorItem);
        });

        palette.classList.add("show");
      }

      // è¤‡è£½é¡è‰²åˆ°å‰ªè²¼ç°¿
      function copyColorToClipboard(color) {
        navigator.clipboard
          .writeText(color)
          .then(() => {
            showMessage(`å·²è¤‡è£½ ${color} åˆ°å‰ªè²¼ç°¿`, "success");
          })
          .catch(() => {
            // å‚™ç”¨æ–¹æ¡ˆ
            const textArea = document.createElement("textarea");
            textArea.value = color;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand("copy");
            document.body.removeChild(textArea);
            showMessage(`å·²è¤‡è£½ ${color} åˆ°å‰ªè²¼ç°¿`, "success");
          });
      }

      // å¥—ç”¨å–®ä¸€é¡è‰²åˆ°é¸ä¸­ç‰©ä»¶
      function applySingleColor(color) {
        google.script.run
          .withSuccessHandler((result) => {
            showMessage(result.message, result.success ? "success" : "error");
          })
          .withFailureHandler((error) => {
            showMessage("å¥—ç”¨é¡è‰²æ™‚ç™¼ç”ŸéŒ¯èª¤: " + error.message, "error");
          })
          .applyColorToSelected(color);
      }

      // å¥—ç”¨åˆ°é¸ä¸­ç‰©ä»¶
      function applyToSelected() {
        if (currentColors.length === 0) {
          showMessage("è«‹å…ˆç”Ÿæˆé…è‰²æ–¹æ¡ˆ", "error");
          return;
        }

        showMessage("è«‹é¸æ“‡è¦å¥—ç”¨çš„é¡è‰²ä¸¦é»æ“Šã€Œå¥—ç”¨ã€æŒ‰éˆ•", "success");
      }

      // å»ºç«‹è‰²å¡é é¢
      function createColorPage() {
        if (currentColors.length === 0) {
          showMessage("è«‹å…ˆç”Ÿæˆé…è‰²æ–¹æ¡ˆ", "error");
          return;
        }

        google.script.run
          .withSuccessHandler((result) => {
            showMessage(result.message, result.success ? "success" : "error");
          })
          .withFailureHandler((error) => {
            showMessage("å»ºç«‹è‰²å¡é é¢æ™‚ç™¼ç”ŸéŒ¯èª¤: " + error.message, "error");
          })
          .createColorPalettePage(currentColors, currentScheme);
      }

      // äº‹ä»¶ç›£è½å™¨
      document
        .getElementById("hexInput")
        .addEventListener("input", updateColorPreview);
      document
        .getElementById("schemeSelect")
        .addEventListener("change", updateSchemeInfo);

      // æ”¯æ´ Enter éµç”Ÿæˆ
      document
        .getElementById("hexInput")
        .addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            generatePalette();
          }
        });
    </script>
  </body>
</html>
