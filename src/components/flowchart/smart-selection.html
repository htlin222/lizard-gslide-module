<details>
  <summary>ğŸ¯ Smart Selection</summary>
  <div class="details-content">
    <div class="form-group">
      <p class="info-text">
        Select shapes based on their relationships in the flowchart hierarchy.
      </p>
    </div>

    <div class="button-group">
      <button class="secondary" onclick="selectAllSiblings()">
        ğŸ‘¥ Siblings
      </button>
      <button class="tertiary" onclick="selectAllLevel()">
        ğŸ—ï¸ Same Level Peers
      </button>
    </div>
    <div class="button-group" style="margin-top: 8px">
      <button class="secondary" onclick="selectAllParents()">â¬†ï¸ Parents</button>
      <button class="tertiary" onclick="selectFamily()">ğŸ£ Descendants</button>
    </div>

    <div class="form-group" style="margin-top: 12px">
      <p class="info-text">
        Align shapes based on their hierarchical relationships.
      </p>
    </div>

    <div class="form-group">
      <label for="alignmentGap">Gap between shapes (px):</label>
      <input
        type="number"
        id="alignmentGap"
        value="20"
        min="0"
        style="width: 80px"
      />
    </div>

    <div class="button-group">
      <button class="secondary" onclick="alignChildrenWithGap()">
        ğŸ¯ Align Children
      </button>
      <button class="tertiary" onclick="alignWithParent()">
        ğŸ¯ Align the Parent
      </button>
    </div>

    <script>
      // Selection functions with loading animations
      function selectAllSiblings() {
        // Get the button and start progress animation
        const button = event.target;
        const originalText = "ğŸ‘¥ Siblings";
        startButtonProgress(button, originalText);

        google.script.run
          .withSuccessHandler(function () {
            endButtonProgress(button, originalText);
            showMessage("All siblings selected!");
          })
          .withFailureHandler(function (error) {
            endButtonProgress(button, originalText);
            showMessage("Error: " + error, true);
          })
          .selectAllSiblings();
      }

      function selectAllLevel() {
        // Get the button and start progress animation
        const button = event.target;
        const originalText = "ğŸ—ï¸ Same Level Peers";
        startButtonProgress(button, originalText);

        google.script.run
          .withSuccessHandler(function () {
            endButtonProgress(button, originalText);
            showMessage("All level shapes selected!");
          })
          .withFailureHandler(function (error) {
            endButtonProgress(button, originalText);
            showMessage("Error: " + error, true);
          })
          .selectAllLevel();
      }

      function selectAllParents() {
        // Get the button and start progress animation
        const button = event.target;
        const originalText = "â¬†ï¸ Parents";
        startButtonProgress(button, originalText);

        google.script.run
          .withSuccessHandler(function () {
            endButtonProgress(button, originalText);
            showMessage("All parents selected!");
          })
          .withFailureHandler(function (error) {
            endButtonProgress(button, originalText);
            showMessage("Error: " + error, true);
          })
          .selectAllParents();
      }

      function selectFamily() {
        // Get the button and start progress animation
        const button = event.target;
        const originalText = "ğŸ£ Descendants";
        startButtonProgress(button, originalText);

        google.script.run
          .withSuccessHandler(function () {
            endButtonProgress(button, originalText);
            showMessage("Family members selected!");
          })
          .withFailureHandler(function (error) {
            endButtonProgress(button, originalText);
            showMessage("Error: " + error, true);
          })
          .selectFamily();
      }

      // Alignment functions with loading animations
      function alignChildrenWithGap() {
        const gap = document.getElementById("alignmentGap").value || 20;

        // Get the button and start progress animation
        const button = event.target;
        const originalText = "ğŸ¯ Align Children";
        startButtonProgress(button, originalText);

        google.script.run
          .withSuccessHandler(function () {
            endButtonProgress(button, originalText);
            showMessage("Children aligned successfully!");
          })
          .withFailureHandler(function (error) {
            endButtonProgress(button, originalText);
            showMessage("Error: " + error, true);
          })
          .alignChildrenWithGap(parseInt(gap));
      }

      function alignWithParent() {
        // Get the button and start progress animation
        const button = event.target;
        const originalText = "ğŸ¯ Align the Parent";
        startButtonProgress(button, originalText);

        google.script.run
          .withSuccessHandler(function () {
            endButtonProgress(button, originalText);
            showMessage("Parent aligned successfully!");
          })
          .withFailureHandler(function (error) {
            endButtonProgress(button, originalText);
            showMessage("Error: " + error, true);
          })
          .alignWithParent();
      }

      // Reuse the progress animation functions from flowchart scripts
      function startButtonProgress(button, originalText) {
        button.classList.add("button-progress");
        button.textContent = "Aligning...";
        button.disabled = true;
      }

      function endButtonProgress(button, originalText) {
        button.classList.remove("button-progress");
        button.textContent = originalText;
        button.disabled = false;
      }

      function showMessage(message, isError = false) {
        // Create a simple toast message at the bottom of the sidebar
        const existingToast = document.getElementById("toast-message");
        if (existingToast) {
          existingToast.remove();
        }

        const toast = document.createElement("div");
        toast.id = "toast-message";
        toast.style.cssText = `
          position: fixed;
          bottom: 16px;
          left: 16px;
          right: 16px;
          background: ${isError ? "#f44336" : "#4caf50"};
          color: white;
          padding: 12px 16px;
          border-radius: 4px;
          font-size: 14px;
          z-index: 1000;
          box-shadow: 0 2px 8px rgba(0,0,0,0.2);
          text-align: center;
          animation: slideUp 0.3s ease-out;
        `;
        toast.textContent = message;
        document.body.appendChild(toast);

        setTimeout(() => {
          if (toast.parentNode) {
            toast.style.animation = "slideDown 0.3s ease-out";
            setTimeout(() => {
              if (toast.parentNode) {
                toast.parentNode.removeChild(toast);
              }
            }, 300);
          }
        }, 3000);
      }
    </script>
  </div>
</details>
